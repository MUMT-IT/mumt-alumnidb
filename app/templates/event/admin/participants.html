{% extends "base.html" %}

{% block content %}
<section class="section">
  <div class="columns">
    <div class="column">
      <h1 class="title">รายชื่อผู้ลงทะเบียน</h1>
      <table class="table is-bordered is-fullwidth">
        <thead>
        <th>ชื่อ</th>
        <th>เวลาลงทะเบียน</th>
        <th>หมายเลขบัตร</th>
        <th>เวลาชำระเงิน</th>
        <th>เวลาเช็คอิน</th>
        </thead>
        {% for participant in event.participants %}
        <tr>
          <td>{{participant}}</td>
          <td>{{participant.register_datetime|localdatetime}}</td>
          <td>
            {% if participant.holding_ticket.ticket_number %}
            {{participant.holding_ticket.ticket_number}}
            {% else %}
            ไม่มีบัตร
            {% endif %}
          </td>
          <td>
            {% if participant.holding_ticket.payment_datetime %}
            {{participant.holding_ticket.payment_datetime|localdatetime}}
            {% else %}
            ยังไม่ชำระเงิน
            {% endif %}
          </td>
          <td>
            {% if participant.holding_ticket %}
              {% if participant.holding_ticket.checkin_datetime %}
              {{participant.holding_ticket.checkin_datetime|localdatetime}}
              {% else %}
                {% if participant.holding_ticket.payment_datetime %}
                <a class="button is-rounded is-success"
                   hx-indicator="this"
                   hx-swap="outerHTML"
                   hx-confirm="คุณแน่ใจว่าต้องการเช็คอินรายการนี้"
                   hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}'
                   hx-post="{{url_for('event.checkin_ticket', ticket_id=participant.holding_ticket.id)}}"
                >เช็คอิน</a>
                {% else %}
                <a class="button is-rounded is-danger"
                   hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}'
                   hx-swap="outerHTML"
                   hx-confirm="คุณแน่ใจว่าต้องการอนุมัติการชำระเงิน"
                   hx-indicator="this"
                   hx-post="{{url_for('event.approve_payment', ticket_id=participant.holding_ticket.id)}}">อนุมัติการชำระเงิน</a>
                {% endif %}
              {% endif %}
            {% else %}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
  </div>
  <div class="columns">
    <div class="column">
      <div class="buttons is-centered">
        <a href="{{url_for('event.all_events')}}" class="button is-rounded">Back</a>
        <a href="{{url_for('event.list_payments', event_id=event.id)}}" class="button is-link is-rounded">ตรวจสอบการชำระเงิน</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}